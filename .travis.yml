before_install:
  - source /etc/lsb-release && echo "deb http://download.rethinkdb.com/apt $DISTRIB_CODENAME main" | sudo tee /etc/apt/sources.list.d/rethinkdb.list
  - wget -qO- http://download.rethinkdb.com/apt/pubkey.gpg | sudo apt-key add -
  - sudo apt-get update
  - sudo apt-get install python3-dev luarocks npm rethinkdb
  - gem install rake-compiler
  - curl https://bootstrap.pypa.io/get-pip.py | sudo python3
  - sudo luarocks install busted

install:
  - make
  - rm -f *.o
  - sudo luarocks make
  - rm -f *.o
  - python3 setup.py build
  - sudo python3 setup.py install
  - rm -rf build
  - sudo npm install
  - rake
  - rm -rf tmp

script:
  - rethinkdb --daemon
  - busted
